{set $locale = $_modx->config.cultureKey}
{set $phonePattern = [' ', '-', '(', ')']}

<!DOCTYPE html>
<html lang="{$locale}">
<head>
    {block 'head'}
        {include 'file:chunks/main/head.html'}
    {/block}
</head>
<body {if $_modx->resource.template == '13'} class="not-found" {/if}>
    {include 'file:chunks/main/svg.html'}


    {block 'header'}
        {include 'file:chunks/main/header.html'}
    {/block}
    <div class="layout">
        
        
        {block 'main'}

        {/block}

        {include 'file:chunks/main/footer.html'}
    </div>

    {include 'file:chunks/menu/menu.html'}

    {include 'file:chunks/main/alert.html'}
    {include 'file:chunks/main/scripts.html'}
    {include 'file:chunks/main/loader.html'}

    
    {include 'file:chunks/main/successModalDefault.html'}

    {include 'file:chunks/main/successModalSendFile.html'}
        

    <script>
        $(window).on('load', function() {
            let scrolled = window.pageYOffset || document.documentElement.scrollTop
            scrolled = scrolled + document.documentElement.clientHeight - (document.documentElement.clientHeight / 4)
            if($('.category-item').length > 0) {
                $('.category-item').each(function() {
                    if($(this).offset().top < scrolled) {
                        $(this).addClass('show')
                    } else {
                        $(this).removeClass('show')
                    }
                })
            }

            if($('.product-item').length > 0) {
                $('.product-item').each(function() {
                    if($(this).offset().top < scrolled + (document.documentElement.clientHeight / 20)) {
                        $(this).addClass('show')
                    } else {
                        $(this).removeClass('show')
                    }
                })
            }
            
            if($('.section-social').length > 0) {
                if($('.section-social').offset().top < scrolled + (document.documentElement.clientHeight / 20)) {
                    $('.section-social').addClass('show')
                } else {
                    $('.section-social').removeClass('show')
                }
            }

            if($('.animate').length > 0) {
                $('.animate').each(function() {
                    if($(this).offset().top < scrolled - (document.documentElement.clientHeight / 8)) {
                        $(this).addClass('show')
                    } else {
                        $(this).removeClass('show')
                    }
                })
            }
            

        })
        $(document).ready(function() {
            // scroll animate
            

            $(window).on('scroll', function() {
                let scrolled = window.pageYOffset || document.documentElement.scrollTop
                scrolled = scrolled + document.documentElement.clientHeight - (document.documentElement.clientHeight / 4)
                
                if($('.category-item').length > 0) {
                    $('.category-item').each(function() {
                        if($(this).offset().top < scrolled) {
                            $(this).addClass('show')
                        } else {
                            $(this).removeClass('show')
                        }
                    })
                }

                if($('.product-item').length > 0) {
                    $('.product-item').each(function() {
                        if($(this).offset().top < scrolled + (document.documentElement.clientHeight / 20)) {
                            $(this).addClass('show')
                        } else {
                            $(this).removeClass('show')
                        }
                    })
                }

                if($('.section-social').length > 0) {
                    if($('.section-social').offset().top < scrolled + (document.documentElement.clientHeight / 20)) {
                        $('.section-social').addClass('show')
                    } else {
                        $('.section-social').removeClass('show')
                    }
                }

                if($('.animate').length > 0) {
                    $('.animate').each(function() {
                        if($(this).offset().top < scrolled - (document.documentElement.clientHeight / 8)) {
                            $(this).addClass('show')
                        } else {
                            $(this).removeClass('show')
                        }
                    })
                }
            })

            // Options module
            $('#msProduct').on('change', '.option-box input', function() {
                
                let optionRelations = $(this).parents('.options-list').attr('data-relation-options').split('&')
                let needle = $(this).attr('name').match(/[^[\]]+(?=])/g) + '=' + $(this).val()
                let relations = []
                
                for (let i = 0; i < optionRelations.length; i++) {
                    $('#msProduct .option-box input[name="options['+optionRelations[i]+']"]').each(function(){
                        if (typeof $(this).attr('data-relations') !== 'undefined') {
                            relations = $(this).attr('data-relations').split('&')
                            if (relations.indexOf( needle ) == -1) {
                                if ($(this).prop('checked') === true) {
                                    $('#msProduct .option-box input[name="options['+optionRelations[i]+']"]:first').prop('checked', true);
                                    $(this).prop('checked', false)
                                }
                                $(this).prop('disabled', true)
                                
                            } else {
                                $(this).prop('disabled', false)
                            }
                        }
                    })
                }
            })


            // search
            $('.search-toggle, .search-close-btn').on('click', function() {
                if(document.body.clientWidth <= 1024) {
                    // $('.layout').toggleClass('blured')
                }
                $('.search-form').toggleClass('active')
            })

            // cart module
            miniShop2.Callbacks.add('Cart.add.ajax.always', 'ajax_log', function(xhr) {
                if (xhr.responseJSON.data.total_count > 0) {
                    $('.minicart-count').removeClass('hidden')
                }
            });
            miniShop2.Callbacks.add('Cart.remove.ajax.always', 'ajax_log', function(xhr) {
                if (xhr.responseJSON.data.total_count == 0) {
                    $('.minicart-count').addClass('hidden')
                }
            });

            $('.one-click-btn').on('click', function() {
                $('#fast-order .minicart-title').text($('h1').text())
            })

        })
    </script>
</body>
</html>